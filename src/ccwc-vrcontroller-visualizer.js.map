{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/ccwc-vrcontroller-visualizer.es6","src/devices/device.es6","src/devices/laptop.es6","src/devices/simulator.es6","src/devices/tisensortag.es6","src/math/quaternion.es6","src/math/util.es6","src/math/vector3.es6","src/sensorfusion/complementary-filter.es6","src/sensorfusion/config.es6","src/sensorfusion/fusion-pose-sensor.es6","src/sensorfusion/pose-predictor.es6","src/sensorfusion/sensor-sample.es6"],"names":[],"mappings":"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","file":"ccwc-vrcontroller-visualizer.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","import TISensorTag from './devices/tisensortag.es6';\r\nimport Simulator from './devices/simulator.es6';\r\nimport Laptop from './devices/laptop.es6';\r\n\r\n/**\r\n * Sensor tag visualizer component\r\n */\r\nexport default class extends HTMLElement {\r\n    /**\r\n     * initialize default class properties\r\n     * @private\r\n     */\r\n    setProperties() {\r\n        /**\r\n         * sensor\r\n         * @type {Device}\r\n         */\r\n        this._sensor = null;\r\n\r\n        /**\r\n         * sensor type\r\n         * @type {String}\r\n         */\r\n        this._sensorType = 'none';\r\n\r\n        /**\r\n         * sample data for simulator\r\n         * @type {String}\r\n         */\r\n        this._sampleData = '';\r\n\r\n        /**\r\n         * 3D cursor (cube thingy) to control with sensor input\r\n         * @type {null}\r\n         */\r\n        this.cursor = null;\r\n\r\n        /**\r\n         * three renderer\r\n         * @type {null}\r\n         */\r\n        this.renderer = null;\r\n\r\n        /**\r\n         * three scene\r\n         * @type {null}\r\n         */\r\n        this.scene = null;\r\n\r\n        /**\r\n         * three camera\r\n         * @type {null}\r\n         */\r\n        this.camera = null;\r\n    }\r\n\r\n    /**\r\n     * on sensor update\r\n     * @param data\r\n     */\r\n    onSensorUpdate(eventtype, data) {\r\n        if (data.sensors.orientation) {\r\n            this.cursor.quaternion.fromArray(data.sensors.orientation);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * connect to sensortag\r\n     */\r\n    connect(sensor) {\r\n        if (sensor) {\r\n            this._sensor = sensor;\r\n        } else {\r\n            switch (this._sensorType) {\r\n                case 'simulator':\r\n                    if (this._sampleData) {\r\n                        var xobj = new XMLHttpRequest();\r\n                        xobj.open('GET', this._sampleData, true);\r\n                        xobj.onreadystatechange = () => {\r\n                            if (xobj.readyState == 4 && xobj.status == '200') {\r\n                                this._sensor = new Simulator(JSON.parse(xobj.responseText).samples);\r\n                                this._sensor.connect( (eventtype, data) => this.onSensorUpdate(eventtype, data));\r\n                            }\r\n                        };\r\n                        xobj.send(null);\r\n                    } else {\r\n                        throw new Error('Simulator requires using sampledata parameter to pass in a URI with samples');\r\n                    }\r\n                    break;\r\n\r\n                case 'laptop':\r\n                    this._sensor = new Laptop();\r\n                    this._sensor.connect( (eventtype, data) => this.onSensorUpdate(eventtype, data));\r\n                    break;\r\n\r\n                case 'tisensortag':\r\n                    this._sensor = new TISensorTag();\r\n                    this._sensor.connect( (eventtype, data) => this.onSensorUpdate(eventtype, data));\r\n                    break;\r\n\r\n                case 'webvr':\r\n                    navigator.getVRDisplays().then( displays => {\r\n                        this.display = displays[0];\r\n                    });\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * parse attributes on element\r\n     * @private\r\n     */\r\n    parseAttributes() {\r\n        if (this.hasAttribute('sensor')) {\r\n            this._sensorType = this.getAttribute('sensor');\r\n        }\r\n\r\n        if (this.hasAttribute('sampledata')) {\r\n            this._sampleData = this.getAttribute('sampledata');\r\n        }\r\n    };\r\n\r\n    /**\r\n     * element created callback\r\n     * @private\r\n     */\r\n    createdCallback() {\r\n        this.setProperties();\r\n        this.parseAttributes();\r\n    };\r\n\r\n    /**\r\n     * element attached callback\r\n     * @private\r\n     */\r\n    attachedCallback() {\r\n        let template = this.owner.querySelector('template');\r\n        let clone = template.content.cloneNode(true);\r\n        this.root = this.createShadowRoot();\r\n        this.root.appendChild(clone);\r\n\r\n        this.dom = {};\r\n        this.dom.scene = this.root.querySelector('.threecontainer');\r\n        setTimeout( () => {\r\n            this.init3DScene();\r\n            this.render();\r\n        }, 100);\r\n    }\r\n\r\n    /**\r\n     * render\r\n     */\r\n    render() {\r\n        this.renderer.render( this.scene, this.camera );\r\n        window.requestAnimationFrame(e => this.render());\r\n    }\r\n\r\n    /**\r\n     * initialize 3D scene\r\n     */\r\n    init3DScene() {\r\n        this.scene = new THREE.Scene();\r\n        var SCREEN_WIDTH = this.offsetWidth, SCREEN_HEIGHT = this.offsetHeight;\r\n        var VIEW_ANGLE = 45, ASPECT = SCREEN_WIDTH / SCREEN_HEIGHT, NEAR = 0.1, FAR = 20000;\r\n        this.camera = new THREE.PerspectiveCamera( VIEW_ANGLE, ASPECT, NEAR, FAR);\r\n        this.scene.add(this.camera);\r\n        this.camera.position.set(0,150,400);\r\n        this.camera.lookAt(this.scene.position);\r\n        this.renderer = new THREE.WebGLRenderer( {antialias:true} );\r\n        this.renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);\r\n        this.dom.scene.appendChild( this.renderer.domElement );\r\n\r\n        var light = new THREE.PointLight(0xffffff);\r\n        light.position.set(100,250,100);\r\n        this.scene.add(light);\r\n\r\n        // SKYBOX\r\n        var skyBoxGeometry = new THREE.CubeGeometry( 10000, 10000, 10000 );\r\n        var skyBoxMaterial = new THREE.MeshBasicMaterial( { color: 0x9999ff, side: THREE.BackSide } );\r\n        var skyBox = new THREE.Mesh( skyBoxGeometry, skyBoxMaterial );\r\n        this.scene.add(skyBox);\r\n\r\n        var geom = new THREE.CubeGeometry( 30, 32, 16 );\r\n        var material = new THREE.MeshLambertMaterial( { color: 0xff0000 } );\r\n        this.cursor = new THREE.Mesh( geom, material );\r\n        this.cursor.position.set(40,40,40);\r\n        this.scene.add(this.cursor);\r\n\r\n        var axes = new THREE.AxisHelper(50);\r\n        //axes.position = this.cursor.position;\r\n        this.scene.add(axes);\r\n\r\n        var gridXZ = new THREE.GridHelper(200, 10);\r\n        this.scene.add(gridXZ);\r\n\r\n        // direction (normalized), origin, length, color(hex)\r\n        var origin = new THREE.Vector3(50,100,50);\r\n        var terminus  = new THREE.Vector3(75,75,75);\r\n        var direction = new THREE.Vector3().subVectors(terminus, origin).normalize();\r\n        var arrow = new THREE.ArrowHelper(direction, origin, 50, 0x884400);\r\n        this.scene.add(arrow);\r\n    }\r\n\r\n    /**\r\n     * element detached callback\r\n     * @private\r\n     */\r\n    detachedCallback() {};\r\n\r\n\r\n    /**\r\n     * attributeChangedCallback\r\n     * @private\r\n     * @param {String} attr attribute changed\r\n     * @param {*} oldVal old value\r\n     * @param {*} newVal new value\r\n     */\r\n    attributeChangedCallback(attr, oldVal, newVal) {};\r\n}","import SensorFusion from '../sensorfusion/fusion-pose-sensor.es6';\r\n\r\nexport default class {\r\n    constructor() {\r\n        /**\r\n         * sensor fusion\r\n         */\r\n        this._sensorfusion = new SensorFusion();\r\n\r\n        /**\r\n         * if already connected\r\n         * @type {Boolean}\r\n         */\r\n        this._connected = false;\r\n\r\n        /**\r\n         * event listeners\r\n         * @type {Array}\r\n         * @private\r\n         */\r\n        this._eventListeners = [];\r\n    }\r\n\r\n    /**\r\n     * connect to sensortag\r\n     * @param cb callback\r\n     */\r\n    connect(cb) {\r\n        this._eventListeners.push(cb);\r\n        if (this._connected) { return; }\r\n    }\r\n\r\n    /**\r\n     * disconnect\r\n     * @param cb\r\n     */\r\n    disconnect(cb) {\r\n        for (var c = 0; c < this._eventListeners.length; c++) {\r\n            if (this._eventListeners[c] === cb) {\r\n                this._eventListeners.splice(c, 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * update listeners with data\r\n     * @param data\r\n     */\r\n    update(data) {\r\n        this._sensorfusion.updateSensorData(data);\r\n        data.sensors.orientation = this._sensorfusion.getOrientation();\r\n        for (var c = 0; c < this._eventListeners.length; c++) {\r\n            this._eventListeners[c]('motionupdate', data);\r\n        }\r\n    }\r\n}","import Device from './device.es6';\r\n\r\nexport default class extends Device {\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    /**\r\n     * connect to sensortag\r\n     * @param cb callback\r\n     */\r\n    connect(cb) {\r\n        super.connect(cb);\r\n        window.addEventListener('devicemotion', event => this.onMotionEvent(event) );\r\n    }\r\n\r\n    /**\r\n     * disconnect\r\n     * @param cb\r\n     */\r\n    disconnect(cb) {\r\n        super.disconnect(cb);\r\n        if (this._eventListeners.length === 0) {\r\n            window.removeEventListener('devicemotion', event => this.onMotionEvent(event));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * on motion event\r\n     * @param event\r\n     */\r\n    onMotionEvent(event) {\r\n        var data = {\r\n            sensors: {\r\n                interval: event.interval,\r\n                timestamp: event.timeStamp,\r\n                accelerometer: {\r\n                    x: event.accelerationIncludingGravity.x,\r\n                    y: event.accelerationIncludingGravity.y,\r\n                    z: event.accelerationIncludingGravity.z\r\n                },\r\n                gyroscope: {\r\n                    alpha: event.rotationRate.alpha,\r\n                    beta: event.rotationRate.beta,\r\n                    gamma: event.rotationRate.gamma\r\n                }\r\n            }\r\n        };\r\n        this.update(data);\r\n    }\r\n}","import Device from './device.es6';\r\n\r\nexport default class extends Device {\r\n    constructor(sampledata) {\r\n        super();\r\n        this.data = sampledata;\r\n\r\n        /**\r\n         * index of current sensor snapshot in sim mode\r\n         * @type {number}\r\n         * @private\r\n         */\r\n        this._simIndex = 0;\r\n    }\r\n\r\n    /**\r\n     * set data\r\n     * @param sampledata\r\n     */\r\n    set data(sampledata) {\r\n        this._data = sampledata;\r\n        var intervalTTL = 0;\r\n        for (var c = 0; c < this._data.length; c++) {\r\n            intervalTTL += this._data[c].interval;\r\n        }\r\n        this._refreshInterval = intervalTTL / this._data.length;\r\n    }\r\n\r\n    /**\r\n     * connect to sensortag\r\n     * @param cb callback\r\n     */\r\n    connect(cb) {\r\n        super.connect(cb);\r\n        this.interval = setInterval( () => {\r\n            this.update(this.getSimulatedSensors());\r\n        }, this._refreshInterval);\r\n    }\r\n\r\n    /**\r\n     * disconnect\r\n     * @param cb\r\n     */\r\n    disconnect(cb) {\r\n        super.disconnect(cb);\r\n        clearInterval(this.interval);\r\n    }\r\n\r\n    /**\r\n     * get simulated sensor data object\r\n     */\r\n    getSimulatedSensors() {\r\n        var sim = {\r\n            connected: true,\r\n            device: {\r\n                systemid: 'xxxxx',\r\n                firmware: 'xxxxx',\r\n                manufacturer: 'xxxxx'\r\n            }\r\n        };\r\n        var accelerometer = this._data[this._simIndex].accelerometer;\r\n        var gyroscope = this._data[this._simIndex].gyroscope;\r\n\r\n        sim.sensors = {\r\n            interval: this._data[this._simIndex].interval,\r\n            timestamp: this._data[this._simIndex].timestamp,\r\n            accelerometer: {\r\n                x: accelerometer.x,\r\n                y: accelerometer.y,\r\n                z: accelerometer.z\r\n            },\r\n            gyroscope: {\r\n                alpha: gyroscope.alpha,\r\n                beta: gyroscope.beta,\r\n                gamma: gyroscope.gamma\r\n            }\r\n        };\r\n        this._simIndex ++;\r\n        if (this._simIndex >= this._data.length) {\r\n            this._simIndex = 0;\r\n        }\r\n        return sim;\r\n    }\r\n\r\n    /**\r\n     * get simulated button data object\r\n     */\r\n    getSimulatedButtons() {\r\n        var data = this.getSimulatedSensors();\r\n        data.sensors.buttons = { active: true, enabled: true };\r\n        data.sensors.buttons.left = Math.random() > .5;\r\n        data.sensors.buttons.right = Math.random() > .5;\r\n        return data;\r\n    }\r\n}","import Device from './device.es6';\r\n\r\nexport default class extends Device {\r\n    constructor() {\r\n        super();\r\n        /**\r\n         * socket connection\r\n         * @type {null}\r\n         */\r\n        this.socket = null;\r\n\r\n        /**\r\n         * if already connected\r\n         * @type {Boolean}\r\n         */\r\n        this._connected = false;\r\n\r\n        /**\r\n         * base UUID\r\n         */\r\n        this._baseUUID = ['f000', '-0451-4000-b000-000000000000'];\r\n\r\n        /**\r\n         * service UUIDS\r\n         * @type {{}}\r\n         * @private\r\n         */\r\n        this._uuid = {};\r\n        this._uuid.temperature = this._baseUUID[0] + 'aa00' + this._baseUUID[1];\r\n        this._uuid.temperatureData = this._baseUUID[0] + 'aa01' + this._baseUUID[1];\r\n        this._uuid.temperatureConfiguration = this._baseUUID[0] + 'aa02' + this._baseUUID[1];\r\n        this._uuid.temperaturePeriod = this._baseUUID[0] + 'aa03' + this._baseUUID[1];\r\n\r\n        this._uuid.accelerometer = this._baseUUID[0] + 'aa10' + this._baseUUID[1];\r\n        this._uuid.accelerometerData = this._baseUUID[0] + 'aa11' + this._baseUUID[1];\r\n        this._uuid.accelerometerConfiguration = this._baseUUID[0] + 'aa12' + this._baseUUID[1];\r\n        this._uuid.accelerometerPeriod = this._baseUUID[0] + 'aa13' + this._baseUUID[1];\r\n\r\n        this._uuid.humidity = this._baseUUID[0] + 'aa20' + this._baseUUID[1];\r\n        this._uuid.humidityData = this._baseUUID[0] + 'aa21' + this._baseUUID[1];\r\n        this._uuid.humidityConfiguration = this._baseUUID[0] + 'aa22' + this._baseUUID[1];\r\n        this._uuid.humidityPeriod = this._baseUUID[0] + 'aa23' + this._baseUUID[1];\r\n    }\r\n\r\n    /**\r\n     * connect to sensortag\r\n     * @param cb callback\r\n     */\r\n    connect(cb) {\r\n        this._eventListeners.push(cb);\r\n        if (this._connected) { return; }\r\n        this.connected = true;\r\n\r\n        if (!navigator.bluetooth) {\r\n            console.log('no bluetooth support in your browser, trying websockets from a local node server');\r\n            this.socket = new WebSocket('ws://localhost:8080');\r\n            this.socket.onerror = function (error) { console.log('WebSocket Error ' + error); };\r\n\r\n            this.socket.onmessage = (e) => {\r\n                var msg = JSON.parse(e.data);\r\n                for (var c = 0; c < this._eventListeners.length; c++) {\r\n                    this._eventListeners[c]('update', msg);\r\n                }\r\n            };\r\n\r\n            this.socket.onopen = (e) => {\r\n                this.socket.send('connect');\r\n            }\r\n\r\n        } else {\r\n            navigator.bluetooth.requestDevice(\r\n                {   filters: [ {name: 'SensorTag'}, { services: [ this._uuid.temperature, this._uuid.accelerometer, this._uuid.humidity ] }],\r\n                    optionalServices: [ this._uuid.temperature, this._uuid.accelerometer, this._uuid.humidity ] })\r\n                .then(device => {\r\n                    console.log('Got device:', device);\r\n                    console.log('id:', device.id);\r\n                    var connected = Promise.resolve();\r\n                    if (!device.connected) {\r\n                        connected = device.gatt.connect();\r\n                    }\r\n                    this.device = device;\r\n                    return connected;\r\n                })\r\n                .then(server => {\r\n                    console.log('Getting Service…', server);\r\n                    //return server.getPrimaryService('f000aa10-0451-4000-b000-000000000000');\r\n                })\r\n                .catch(error => this.onDeviceError(error));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * on device requested success\r\n     * @param device\r\n     */\r\n    onDeviceRequestedSuccess(device) {\r\n        this.connected = device.gatt.connect();\r\n    }\r\n\r\n    /**\r\n     * on device requested error\r\n     * @param device\r\n     */\r\n    onDeviceError(err) {\r\n        console.log(err);\r\n    }\r\n}","/**\r\n * Heavily lifted from WebVR-Polyfill project by Boris Smus: https://github.com/borismus/webvr-polyfill\r\n * but refactored to use different data source provided over BLE by the TI Sensor Tag\r\n *\r\n * This piece in particular was also pulled by Boris from ThreeJS math\r\n *\r\n * original license from WebVR-Polyfill is as follows:\r\n * Copyright 2015 Google Inc. All Rights Reserved.\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport Vector3 from './vector3.es6';\r\n\r\nexport default class {\r\n    constructor( x, y, z, w ) {\r\n        this.x = x || 0;\r\n        this.y = y || 0;\r\n        this.z = z || 0;\r\n        this.w = ( w !== undefined ) ? w : 1;\r\n    }\r\n\r\n    set( x, y, z, w ) {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n        this.w = w;\r\n\r\n        return this;\r\n    }\r\n\r\n    copy( quaternion ) {\r\n        this.x = quaternion.x;\r\n        this.y = quaternion.y;\r\n        this.z = quaternion.z;\r\n        this.w = quaternion.w;\r\n\r\n        return this;\r\n    }\r\n\r\n    setFromEulerXYZ( x, y, z ) {\r\n        var c1 = Math.cos( x / 2 );\r\n        var c2 = Math.cos( y / 2 );\r\n        var c3 = Math.cos( z / 2 );\r\n        var s1 = Math.sin( x / 2 );\r\n        var s2 = Math.sin( y / 2 );\r\n        var s3 = Math.sin( z / 2 );\r\n\r\n        this.x = s1 * c2 * c3 + c1 * s2 * s3;\r\n        this.y = c1 * s2 * c3 - s1 * c2 * s3;\r\n        this.z = c1 * c2 * s3 + s1 * s2 * c3;\r\n        this.w = c1 * c2 * c3 - s1 * s2 * s3;\r\n\r\n        return this;\r\n    }\r\n\r\n    setFromEulerYXZ( x, y, z ) {\r\n        var c1 = Math.cos( x / 2 );\r\n        var c2 = Math.cos( y / 2 );\r\n        var c3 = Math.cos( z / 2 );\r\n        var s1 = Math.sin( x / 2 );\r\n        var s2 = Math.sin( y / 2 );\r\n        var s3 = Math.sin( z / 2 );\r\n\r\n        this.x = s1 * c2 * c3 + c1 * s2 * s3;\r\n        this.y = c1 * s2 * c3 - s1 * c2 * s3;\r\n        this.z = c1 * c2 * s3 - s1 * s2 * c3;\r\n        this.w = c1 * c2 * c3 + s1 * s2 * s3;\r\n\r\n        return this;\r\n    }\r\n\r\n    setFromAxisAngle( axis, angle ) {\r\n        // http://www.euclideanspace.com/maths/geometry/rotations/conversions/angleToQuaternion/index.htm\r\n        // assumes axis is normalized\r\n\r\n        var halfAngle = angle / 2, s = Math.sin( halfAngle );\r\n\r\n        this.x = axis.x * s;\r\n        this.y = axis.y * s;\r\n        this.z = axis.z * s;\r\n        this.w = Math.cos( halfAngle );\r\n\r\n        return this;\r\n    }\r\n\r\n    multiply( q ) {\r\n        return this.multiplyQuaternions( this, q );\r\n    }\r\n\r\n    multiplyQuaternions( a, b ) {\r\n        // from http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/code/index.htm\r\n\r\n        var qax = a.x, qay = a.y, qaz = a.z, qaw = a.w;\r\n        var qbx = b.x, qby = b.y, qbz = b.z, qbw = b.w;\r\n\r\n        this.x = qax * qbw + qaw * qbx + qay * qbz - qaz * qby;\r\n        this.y = qay * qbw + qaw * qby + qaz * qbx - qax * qbz;\r\n        this.z = qaz * qbw + qaw * qbz + qax * qby - qay * qbx;\r\n        this.w = qaw * qbw - qax * qbx - qay * qby - qaz * qbz;\r\n\r\n        return this;\r\n    }\r\n\r\n    inverse() {\r\n        this.x *= -1;\r\n        this.y *= -1;\r\n        this.z *= -1;\r\n\r\n        this.normalize();\r\n\r\n        return this;\r\n    }\r\n\r\n    normalize() {\r\n        var l = Math.sqrt( this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w );\r\n\r\n        if ( l === 0 ) {\r\n            this.x = 0;\r\n            this.y = 0;\r\n            this.z = 0;\r\n            this.w = 1;\r\n        } else {\r\n            l = 1 / l;\r\n\r\n            this.x = this.x * l;\r\n            this.y = this.y * l;\r\n            this.z = this.z * l;\r\n            this.w = this.w * l;\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    slerp( qb, t ) {\r\n        if ( t === 0 ) return this;\r\n        if ( t === 1 ) return this.copy( qb );\r\n\r\n        var x = this.x, y = this.y, z = this.z, w = this.w;\r\n\r\n        // http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/slerp/\r\n\r\n        var cosHalfTheta = w * qb.w + x * qb.x + y * qb.y + z * qb.z;\r\n\r\n        if ( cosHalfTheta < 0 ) {\r\n            this.w = - qb.w;\r\n            this.x = - qb.x;\r\n            this.y = - qb.y;\r\n            this.z = - qb.z;\r\n\r\n            cosHalfTheta = - cosHalfTheta;\r\n        } else {\r\n            this.copy( qb );\r\n        }\r\n\r\n        if ( cosHalfTheta >= 1.0 ) {\r\n            this.w = w;\r\n            this.x = x;\r\n            this.y = y;\r\n            this.z = z;\r\n\r\n            return this;\r\n        }\r\n\r\n        var halfTheta = Math.acos( cosHalfTheta );\r\n        var sinHalfTheta = Math.sqrt( 1.0 - cosHalfTheta * cosHalfTheta );\r\n\r\n        if ( Math.abs( sinHalfTheta ) < 0.001 ) {\r\n            this.w = 0.5 * ( w + this.w );\r\n            this.x = 0.5 * ( x + this.x );\r\n            this.y = 0.5 * ( y + this.y );\r\n            this.z = 0.5 * ( z + this.z );\r\n\r\n            return this;\r\n        }\r\n\r\n        var ratioA = Math.sin( ( 1 - t ) * halfTheta ) / sinHalfTheta,\r\n            ratioB = Math.sin( t * halfTheta ) / sinHalfTheta;\r\n\r\n        this.w = ( w * ratioA + this.w * ratioB );\r\n        this.x = ( x * ratioA + this.x * ratioB );\r\n        this.y = ( y * ratioA + this.y * ratioB );\r\n        this.z = ( z * ratioA + this.z * ratioB );\r\n\r\n        return this;\r\n    }\r\n\r\n    setFromUnitVectors(vFrom, vTo) {\r\n        // http://lolengine.net/blog/2014/02/24/quaternion-from-two-vectors-final\r\n        // assumes direction vectors vFrom and vTo are normalized\r\n        var v1, r;\r\n        var EPS = 0.000001;\r\n\r\n        if (v1 === undefined) v1 = new Vector3();\r\n\r\n        r = vFrom.dot(vTo) + 1;\r\n\r\n        if (r < EPS) {\r\n            r = 0;\r\n\r\n            if (Math.abs(vFrom.x) > Math.abs(vFrom.z)) {\r\n                v1.set(-vFrom.y, vFrom.x, 0);\r\n            } else {\r\n                v1.set(0, -vFrom.z, vFrom.y);\r\n            }\r\n        } else {\r\n            v1.crossVectors(vFrom, vTo);\r\n        }\r\n\r\n        this.x = v1.x;\r\n        this.y = v1.y;\r\n        this.z = v1.z;\r\n        this.w = r;\r\n\r\n        this.normalize();\r\n    }\r\n}","/**\r\n * Heavily lifted from WebVR-Polyfill project by Boris Smus: https://github.com/borismus/webvr-polyfill\r\n * but refactored to use different data source provided over BLE by the TI Sensor Tag\r\n *\r\n * This piece in particular was also pulled by Boris from ThreeJS math\r\n *\r\n * original license from WebVR-Polyfill is as follows:\r\n * Copyright 2015 Google Inc. All Rights Reserved.\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nexport default {\r\n    degToRad: Math.PI / 180,\r\n    radToDeg: 180 / Math.PI,\r\n    MIN_TIMESTEP: 0.001,\r\n    MAX_TIMESTEP: 1,\r\n\r\n    // Helper method to validate the time steps of sensor timestamps.\r\n    isTimestampDeltaValid: function(timestampDeltaS) {\r\n        if (isNaN(timestampDeltaS)) {\r\n            return false;\r\n        }\r\n        if (timestampDeltaS <= this.MIN_TIMESTEP) {\r\n            return false;\r\n        }\r\n        if (timestampDeltaS > this.MAX_TIMESTEP) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n}","/**\r\n * Heavily lifted from WebVR-Polyfill project by Boris Smus: https://github.com/borismus/webvr-polyfill\r\n * but refactored to use different data source provided over BLE by the TI Sensor Tag\r\n *\r\n * This piece in particular was also pulled by Boris from ThreeJS math\r\n *\r\n * original license from WebVR-Polyfill is as follows:\r\n * Copyright 2015 Google Inc. All Rights Reserved.\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nexport default class {\r\n    constructor(x, y, z) {\r\n        this.x = x || 0;\r\n        this.y = y || 0;\r\n        this.z = z || 0;\r\n    }\r\n\r\n    set( x, y, z ) {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n\r\n        return this;\r\n    }\r\n\r\n    copy( v ) {\r\n        this.x = v.x;\r\n        this.y = v.y;\r\n        this.z = v.z;\r\n\r\n        return this;\r\n    }\r\n\r\n    length() {\r\n        return Math.sqrt( this.x * this.x + this.y * this.y + this.z * this.z );\r\n    }\r\n\r\n    normalize() {\r\n        var scalar = this.length();\r\n\r\n        if ( scalar !== 0 ) {\r\n            var invScalar = 1 / scalar;\r\n\r\n            this.multiplyScalar(invScalar);\r\n        } else {\r\n            this.x = 0;\r\n            this.y = 0;\r\n            this.z = 0;\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    multiplyScalar( scalar ) {\r\n        this.x *= scalar;\r\n        this.y *= scalar;\r\n        this.z *= scalar;\r\n    }\r\n\r\n    applyQuaternion( q ) {\r\n        var x = this.x;\r\n        var y = this.y;\r\n        var z = this.z;\r\n\r\n        var qx = q.x;\r\n        var qy = q.y;\r\n        var qz = q.z;\r\n        var qw = q.w;\r\n\r\n        // calculate quat * vector\r\n        var ix =  qw * x + qy * z - qz * y;\r\n        var iy =  qw * y + qz * x - qx * z;\r\n        var iz =  qw * z + qx * y - qy * x;\r\n        var iw = - qx * x - qy * y - qz * z;\r\n\r\n        // calculate result * inverse quat\r\n        this.x = ix * qw + iw * - qx + iy * - qz - iz * - qy;\r\n        this.y = iy * qw + iw * - qy + iz * - qx - ix * - qz;\r\n        this.z = iz * qw + iw * - qz + ix * - qy - iy * - qx;\r\n\r\n        return this;\r\n    }\r\n\r\n    dot( v ) {\r\n        return this.x * v.x + this.y * v.y + this.z * v.z;\r\n    }\r\n\r\n    crossVectors( a, b ) {\r\n        var ax = a.x, ay = a.y, az = a.z;\r\n        var bx = b.x, by = b.y, bz = b.z;\r\n\r\n        this.x = ay * bz - az * by;\r\n        this.y = az * bx - ax * bz;\r\n        this.z = ax * by - ay * bx;\r\n\r\n        return this;\r\n    }\r\n};","/**\r\n * Heavily lifted from WebVR-Polyfill project by Boris Smus: https://github.com/borismus/webvr-polyfill\r\n * but refactored to use different data source provided over BLE by the TI Sensor Tag\r\n *\r\n * original license from WebVR-Polyfill is as follows:\r\n * Copyright 2015 Google Inc. All Rights Reserved.\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n\r\n/**\r\n * TODO: Fix up all \"new THREE\" instantiations to improve performance.\r\n */\r\nimport SensorSample from './sensor-sample.es6';\r\nimport Quaternion from  '../math/quaternion.es6';\r\nimport Vector3 from  '../math/vector3.es6';\r\nimport MathUtil from '../math/util.es6';\r\n\r\n/**\r\n * An implementation of a simple complementary filter, which fuses gyroscope and\r\n * accelerometer data from the 'devicemotion' event.\r\n *\r\n * Accelerometer data is very noisy, but stable over the long term.\r\n * Gyroscope data is smooth, but tends to drift over the long term.\r\n *\r\n * This fusion is relatively simple:\r\n * 1. Get orientation estimates from accelerometer by applying a low-pass filter\r\n *    on that data.\r\n * 2. Get orientation estimates from gyroscope by integrating over time.\r\n * 3. Combine the two estimates, weighing (1) in the long term, but (2) for the\r\n *    short term.\r\n */\r\n\r\nexport default class {\r\n    constructor(kFilter) {\r\n        this.kFilter = kFilter;\r\n\r\n        // Raw sensor measurements.\r\n        this.currentAccelMeasurement = new SensorSample();\r\n        this.currentGyroMeasurement = new SensorSample();\r\n        this.previousGyroMeasurement = new SensorSample();\r\n\r\n        // Current filter orientation\r\n        this.filterQ = new Quaternion();\r\n        this.previousFilterQ = new Quaternion();\r\n\r\n        // Orientation based on the accelerometer.\r\n        this.accelQ = new Quaternion();\r\n        // Whether or not the orientation has been initialized.\r\n        this.isOrientationInitialized = false;\r\n        // Running estimate of gravity based on the current orientation.\r\n        this.estimatedGravity = new Vector3();\r\n        // Measured gravity based on accelerometer.\r\n        this.measuredGravity = new Vector3();\r\n\r\n        // Debug only quaternion of gyro-based orientation.\r\n        this.gyroIntegralQ = new Quaternion();\r\n    }\r\n\r\n\r\n    addAccelMeasurement(vector, timestampS) {\r\n        this.currentAccelMeasurement.set(vector, timestampS);\r\n    }\r\n\r\n    addGyroMeasurement(vector, timestampS) {\r\n        this.currentGyroMeasurement.set(vector, timestampS);\r\n\r\n        var deltaT = timestampS - this.previousGyroMeasurement.timestampS;\r\n        if (MathUtil.isTimestampDeltaValid(deltaT)) {\r\n            this.run_();\r\n        }\r\n\r\n        this.previousGyroMeasurement.copy(this.currentGyroMeasurement);\r\n    }\r\n\r\n    run_() {\r\n        if (!this.isOrientationInitialized) {\r\n            this.accelQ = this.accelToQuaternion_(this.currentAccelMeasurement.sample);\r\n            this.previousFilterQ.copy(this.accelQ);\r\n            this.isOrientationInitialized = true;\r\n            return;\r\n        }\r\n\r\n        var deltaT = this.currentGyroMeasurement.timestampS -\r\n            this.previousGyroMeasurement.timestampS;\r\n\r\n        // Convert gyro rotation vector to a quaternion delta.\r\n        var gyroDeltaQ = this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample, deltaT);\r\n        this.gyroIntegralQ.multiply(gyroDeltaQ);\r\n\r\n        // filter_1 = K * (filter_0 + gyro * dT) + (1 - K) * accel.\r\n        this.filterQ.copy(this.previousFilterQ);\r\n        this.filterQ.multiply(gyroDeltaQ);\r\n\r\n        // Calculate the delta between the current estimated gravity and the real\r\n        // gravity vector from accelerometer.\r\n        var invFilterQ = new Quaternion();\r\n        invFilterQ.copy(this.filterQ);\r\n        invFilterQ.inverse();\r\n\r\n        this.estimatedGravity.set(0, 0, -1);\r\n        this.estimatedGravity.applyQuaternion(invFilterQ);\r\n        this.estimatedGravity.normalize();\r\n\r\n        this.measuredGravity.copy(this.currentAccelMeasurement.sample);\r\n        this.measuredGravity.normalize();\r\n\r\n        // Compare estimated gravity with measured gravity, get the delta quaternion\r\n        // between the two.\r\n        var deltaQ = new Quaternion();\r\n        deltaQ.setFromUnitVectors(this.estimatedGravity, this.measuredGravity);\r\n        deltaQ.inverse();\r\n\r\n        /*if (DEBUG) {\r\n            console.log('Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)',\r\n                MathUtil.radToDeg * Util.getQuaternionAngle(deltaQ),\r\n                (this.estimatedGravity.x).toFixed(1),\r\n                (this.estimatedGravity.y).toFixed(1),\r\n                (this.estimatedGravity.z).toFixed(1),\r\n                (this.measuredGravity.x).toFixed(1),\r\n                (this.measuredGravity.y).toFixed(1),\r\n                (this.measuredGravity.z).toFixed(1));\r\n        }*/\r\n\r\n        // Calculate the SLERP target: current orientation plus the measured-estimated\r\n        // quaternion delta.\r\n        var targetQ = new Quaternion();\r\n        targetQ.copy(this.filterQ);\r\n        targetQ.multiply(deltaQ);\r\n\r\n        // SLERP factor: 0 is pure gyro, 1 is pure accel.\r\n        this.filterQ.slerp(targetQ, 1 - this.kFilter);\r\n\r\n        this.previousFilterQ.copy(this.filterQ);\r\n    }\r\n\r\n    getOrientation() {\r\n        return this.filterQ;\r\n    }\r\n\r\n    accelToQuaternion_(accel) {\r\n        var normAccel = new Vector3();\r\n        normAccel.copy(accel);\r\n        normAccel.normalize();\r\n        var quat = new Quaternion();\r\n        quat.setFromUnitVectors(new Vector3(0, 0, -1), normAccel);\r\n        quat.inverse();\r\n        return quat;\r\n    }\r\n\r\n    gyroToQuaternionDelta_(gyro, dt) {\r\n        // Extract axis and angle from the gyroscope data.\r\n        var quat = new Quaternion();\r\n        var axis = new Vector3();\r\n        axis.copy(gyro);\r\n        axis.normalize();\r\n        quat.setFromAxisAngle(axis, gyro.length() * dt);\r\n        return quat;\r\n    }\r\n}","export default {\r\n    K_FILTER: 0.98, // Default: 0.98.\r\n\r\n    // How far into the future to predict during fast motion (in seconds).\r\n    PREDICTION_TIME_S: 0.040, // Default: 0.040.\r\n\r\n    YAW_ONLY: true\r\n}","/**\r\n * Heavily lifted from WebVR-Polyfill project by Boris Smus: https://github.com/borismus/webvr-polyfill\r\n * but refactored to use different data source provided over BLE by the TI Sensor Tag\r\n *\r\n * original license from WebVR-Polyfill is as follows:\r\n * Copyright 2015 Google Inc. All Rights Reserved.\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport ComplementaryFilter from './complementary-filter.es6';\r\nimport PosePredictor from './pose-predictor.es6';\r\n//import TouchPanner from '../touch-panner.es6';\r\nimport MathUtil from '../math/util.es6';\r\nimport Vector3 from '../math/vector3.es6';\r\nimport Quaternion from '../math/quaternion.es6';\r\nimport Config from './config.es6';\r\n\r\n/**\r\n * The pose sensor, implemented using DeviceMotion APIs.\r\n */\r\nexport default class {\r\n    constructor() {\r\n        this.deviceId = 'webvr-polyfill:fused';\r\n        this.deviceName = 'VR Position Device (webvr-polyfill:fused)';\r\n\r\n        this.accelerometer = new Vector3();\r\n        this.gyroscope = new Vector3();\r\n\r\n        //window.addEventListener('devicemotion', this.onDeviceMotionChange_.bind(this));\r\n        //window.addEventListener('orientationchange', this.onScreenOrientationChange_.bind(this));\r\n\r\n        this.filter = new ComplementaryFilter(Config.K_FILTER);\r\n        this.posePredictor = new PosePredictor(Config.PREDICTION_TIME_S);\r\n     //   this.touchPanner = new TouchPanner();\r\n\r\n        this.filterToWorldQ = new Quaternion();\r\n\r\n        // Set the filter to world transform, depending on OS.\r\n        //if (Util.isIOS()) {\r\n       // this.filterToWorldQ.setFromAxisAngle(new Vector3(1, 0, 0), Math.PI / 2);\r\n        //} else {\r\n          this.filterToWorldQ.setFromAxisAngle(new Vector3(1, 0, 0), -Math.PI / 2);\r\n        //}\r\n\r\n        this.inverseWorldToScreenQ = new Quaternion();\r\n        this.worldToScreenQ = new Quaternion();\r\n        this.originalPoseAdjustQ = new Quaternion();\r\n        this.originalPoseAdjustQ.setFromAxisAngle(new Vector3(0, 0, 1),\r\n            -window.orientation * Math.PI / 180);\r\n\r\n        //this.setScreenTransform_();\r\n        // Adjust this filter for being in landscape mode.\r\n        //if (Util.isLandscapeMode()) {\r\n        //  this.filterToWorldQ.multiply(this.inverseWorldToScreenQ);\r\n        //}\r\n\r\n        // Keep track of a reset transform for resetSensor.\r\n        this.resetQ = new Quaternion();\r\n\r\n        //this.isFirefoxAndroid = Util.isFirefoxAndroid();\r\n        //this.isIOS = Util.isIOS();\r\n\r\n        this.orientationOut_ = new Float32Array(4);\r\n    }\r\n\r\n    getPosition() {\r\n        // This PoseSensor doesn't support position\r\n        return null;\r\n    }\r\n\r\n    getOrientation() {\r\n        // Convert from filter space to the the same system used by the\r\n        // deviceorientation event.\r\n        var orientation = this.filter.getOrientation();\r\n\r\n        // Predict orientation.\r\n        this.predictedQ = this.posePredictor.getPrediction(orientation, this.gyroscope, this.previousTimestampS);\r\n\r\n        // Convert to THREE coordinate system: -Z forward, Y up, X right.\r\n        var out = new Quaternion();\r\n        out.copy(this.filterToWorldQ);\r\n        out.multiply(this.resetQ);\r\n        out.multiply(this.predictedQ);\r\n        out.multiply(this.worldToScreenQ);\r\n        \r\n        this.orientationOut_[0] = out.x;\r\n        this.orientationOut_[1] = out.y;\r\n        this.orientationOut_[2] = out.z;\r\n        this.orientationOut_[3] = out.w;\r\n        return this.orientationOut_;\r\n    }\r\n\r\n    resetPose() {\r\n        // Reduce to inverted yaw-only.\r\n        this.resetQ.copy(this.filter.getOrientation());\r\n        this.resetQ.x = 0;\r\n        this.resetQ.y = 0;\r\n        this.resetQ.z *= -1;\r\n        this.resetQ.normalize();\r\n\r\n        // Take into account original pose.\r\n        this.resetQ.multiply(this.originalPoseAdjustQ);\r\n    }\r\n\r\n    updateSensorData(data) {\r\n        if (data.sensors && data.sensors.accelerometer && data.sensors.gyroscope) {\r\n            var accGravity = data.sensors.accelerometer; //todo: gravity!\r\n            var rotRate = data.sensors.gyroscope;\r\n\r\n            //var accGravity = data.accelerationIncludingGravity; //todo: gravity!\r\n            //var rotRate = data.rotationRate;\r\n            var timestampS = data.sensors.timestamp / 1000;\r\n\r\n            var deltaS = timestampS - this.previousTimestampS;\r\n            if (deltaS <= MathUtil.MIN_TIMESTEP || deltaS > MathUtil.MAX_TIMESTEP) {\r\n                console.warn('Invalid timestamps detected. Time step between successive ' +\r\n                    'gyroscope sensor samples is very small or not monotonic');\r\n                this.previousTimestampS = timestampS;\r\n                return;\r\n            }\r\n        \r\n            this.accelerometer.set(-accGravity.x, -accGravity.y, -accGravity.z);\r\n            this.gyroscope.set(rotRate.alpha, rotRate.beta, rotRate.gamma);\r\n            this.gyroscope.multiplyScalar(Math.PI / 180);\r\n            \r\n            this.filter.addAccelMeasurement(this.accelerometer, timestampS);\r\n            this.filter.addGyroMeasurement(this.gyroscope, timestampS);\r\n\r\n            this.previousTimestampS = timestampS;\r\n        }\r\n    }\r\n}\r\n","/**\r\n * Heavily lifted from WebVR-Polyfill project by Boris Smus: https://github.com/borismus/webvr-polyfill\r\n * but refactored to use different data source provided over BLE by the TI Sensor Tag\r\n *\r\n * original license from WebVR-Polyfill is as follows:\r\n * Copyright 2015 Google Inc. All Rights Reserved.\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport Quaternion from '../math/quaternion.es6';\r\nimport Vector3 from '../math/vector3.es6';\r\nimport MathUtil from '../math/util.es6';\r\n\r\n/**\r\n * Given an orientation and the gyroscope data, predicts the future orientation\r\n * of the head. This makes rendering appear faster.\r\n *\r\n * Also see: http://msl.cs.uiuc.edu/~lavalle/papers/LavYerKatAnt14.pdf\r\n *\r\n * @param {Number} predictionTimeS time from head movement to the appearance of\r\n * the corresponding image.\r\n */\r\n\r\nexport default class {\r\n    constructor(predictionTimeS) {\r\n        this.predictionTimeS = predictionTimeS;\r\n\r\n        // The quaternion corresponding to the previous state.\r\n        this.previousQ = new Quaternion();\r\n        // Previous time a prediction occurred.\r\n        this.previousTimestampS = null;\r\n\r\n        // The delta quaternion that adjusts the current pose.\r\n        this.deltaQ = new Quaternion();\r\n        // The output quaternion.\r\n        this.outQ = new Quaternion();\r\n    }\r\n\r\n    getPrediction(currentQ, gyro, timestampS) {\r\n        if (!this.previousTimestampS) {\r\n            this.previousQ.copy(currentQ);\r\n            this.previousTimestampS = timestampS;\r\n            return currentQ;\r\n        }\r\n\r\n        // Calculate axis and angle based on gyroscope rotation rate data.\r\n        var axis = new Vector3();\r\n        axis.copy(gyro);\r\n        axis.normalize();\r\n\r\n        var angularSpeed = gyro.length();\r\n\r\n        // If we're rotating slowly, don't do prediction.\r\n        if (angularSpeed < MathUtil.degToRad * 20) {\r\n            //if (DEBUG) {\r\n               // console.log('Moving slowly, at %s deg/s: no prediction',\r\n                  //  (MathUtil.radToDeg * angularSpeed).toFixed(1));\r\n            //}\r\n            this.outQ.copy(currentQ);\r\n            this.previousQ.copy(currentQ);\r\n            return this.outQ;\r\n        }\r\n\r\n        // Get the predicted angle based on the time delta and latency.\r\n        var deltaT = timestampS - this.previousTimestampS;\r\n        var predictAngle = angularSpeed * this.predictionTimeS;\r\n\r\n        this.deltaQ.setFromAxisAngle(axis, predictAngle);\r\n        this.outQ.copy(this.previousQ);\r\n        this.outQ.multiply(this.deltaQ);\r\n\r\n        this.previousQ.copy(currentQ);\r\n\r\n        return this.outQ;\r\n    }\r\n};","/**\r\n * Heavily lifted from WebVR-Polyfill project by Boris Smus: https://github.com/borismus/webvr-polyfill\r\n * but refactored to use different data source provided over BLE by the TI Sensor Tag\r\n *\r\n * original license from WebVR-Polyfill is as follows:\r\n * Copyright 2015 Google Inc. All Rights Reserved.\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nexport default class {\r\n    constructor(sample, timestampS) {\r\n        this.set(sample, timestampS);\r\n    }\r\n\r\n    set(sample, timestampS) {\r\n        this.sample = sample;\r\n        this.timestampS = timestampS;\r\n    }\r\n\r\n    copy(sensorSample) {\r\n        this.set(sensorSample.sample, sensorSample.timestampS);\r\n    };\r\n}"]}